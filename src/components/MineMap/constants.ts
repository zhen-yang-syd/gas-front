/**
 * 传感器位置配置
 *
 * 基于 gas-path-2.drawio 文件精确复刻
 * 画布尺寸: 1600 × 550
 *
 * 布局说明 (基于 drawio):
 * - 顶层主巷道: y=200-210
 * - 中层回风巷: y=280-290
 * - 下层巷道: y=360-370
 * - 底层L形分支: y=480-490
 * - 主斜向通道: (950,200) → (1157,490)
 */

export interface SensorPosition {
  x: number;
  y: number;
  zone: number;
  type: "T" | "WD" | "FS";
}

// 地图尺寸 - 基于 drawio 坐标系
export const MAP_WIDTH = 1600;
export const MAP_HEIGHT = 550;

// 采区颜色
export const ZONE_COLORS: Record<number, string> = {
  1: "#3B82F6", // 蓝色 - 左侧区域
  2: "#10B981", // 绿色 - 中部区域
  3: "#F59E0B", // 橙色 - 右中区域
  4: "#8B5CF6", // 紫色 - 斜向通道区域
  5: "#EC4899", // 粉色 - L形分支区域
};

/**
 * 传感器位置 - 基于 drawio 椭圆坐标
 * drawio 中椭圆尺寸为 30x30，这里取中心点 (x+15, y+15)
 */

// T传感器位置 (瓦斯浓度) - 共20个
export const T_SENSOR_POSITIONS: Record<string, SensorPosition> = {
  // ====== 左侧区域 (1个) ======
  T010101: { x: 115, y: 325, zone: 1, type: "T" }, // (100,310) -> 中心(115,325)

  // ====== 工作面3区域 (6个) ======
  T010102: { x: 405, y: 315, zone: 1, type: "T" }, // (390,300)
  T010103: { x: 465, y: 305, zone: 1, type: "T" }, // (450,290)
  T010104: { x: 405, y: 345, zone: 1, type: "T" }, // (390,330)
  T010105: { x: 465, y: 345, zone: 1, type: "T" }, // (450,330)
  T010106: { x: 515, y: 345, zone: 1, type: "T" }, // (500,330)

  // ====== 中部垂直连接区域 (8个) ======
  T010201: { x: 565, y: 255, zone: 2, type: "T" }, // (550,240)
  T010202: { x: 545, y: 315, zone: 2, type: "T" }, // (530,300)
  T010203: { x: 635, y: 315, zone: 2, type: "T" }, // (620,300)
  T010204: { x: 665, y: 315, zone: 2, type: "T" }, // (650,300)
  T010205: { x: 695, y: 315, zone: 2, type: "T" }, // (680,300)

  // ====== 下部巷道区域 (3个) ======
  T010301: { x: 635, y: 345, zone: 3, type: "T" }, // (620,330)
  T010302: { x: 665, y: 345, zone: 3, type: "T" }, // (650,330)
  T010303: { x: 695, y: 345, zone: 3, type: "T" }, // (680,330)

  // ====== L形分支入口区域 (4个) ======
  T010304: { x: 1085, y: 315, zone: 3, type: "T" }, // (1070,300)
  T010305: { x: 1145, y: 305, zone: 3, type: "T" }, // (1130,290)
  T010306: { x: 1145, y: 335, zone: 3, type: "T" }, // (1130,320)
  T010307: { x: 1175, y: 325, zone: 3, type: "T" }, // (1160,310)

  // ====== 斜向通道区域 (2个) ======
  T010401: { x: 1235, y: 255, zone: 4, type: "T" }, // (1220,240)
  T010501: { x: 1265, y: 255, zone: 4, type: "T" }, // (1250,240)
};

/**
 * WD传感器位置 (温度) - 共16个
 * 基于文档定义: WD010101-WD010111, WD010201, WD010301-WD010302, WD010401, WD010501
 */
export const WD_SENSOR_POSITIONS: Record<string, SensorPosition> = {
  // ====== 三采区域 (11个: WD1-WD11) ======
  WD010101: { x: 805, y: 155, zone: 4, type: "WD" },  // WD1
  WD010102: { x: 785, y: 185, zone: 4, type: "WD" },  // WD2
  WD010103: { x: 815, y: 185, zone: 4, type: "WD" },  // WD3
  WD010104: { x: 945, y: 165, zone: 4, type: "WD" },  // WD4
  WD010105: { x: 975, y: 155, zone: 4, type: "WD" },  // WD5
  WD010106: { x: 975, y: 185, zone: 4, type: "WD" },  // WD6
  WD010107: { x: 1195, y: 150, zone: 4, type: "WD" }, // WD7
  WD010108: { x: 1175, y: 180, zone: 4, type: "WD" }, // WD8
  WD010109: { x: 1205, y: 180, zone: 4, type: "WD" }, // WD9
  WD010110: { x: 1065, y: 395, zone: 5, type: "WD" }, // WD10
  WD010111: { x: 1085, y: 415, zone: 5, type: "WD" }, // WD11

  // ====== 四采水仓区域 (1个: WD12) ======
  WD010201: { x: 1055, y: 425, zone: 5, type: "WD" }, // WD12

  // ====== 四采轨道区域 (2个: WD13-WD14) ======
  WD010301: { x: 1275, y: 385, zone: 5, type: "WD" }, // WD13
  WD010302: { x: 1425, y: 425, zone: 5, type: "WD" }, // WD14

  // ====== 四采北翼区域 (1个: WD15) ======
  WD010401: { x: 1256, y: 455, zone: 5, type: "WD" }, // WD15

  // ====== 四采无极绳区域 (1个: WD16) ======
  WD010501: { x: 1486, y: 455, zone: 5, type: "WD" }, // WD16
};

/**
 * FS传感器位置 (风速) - 共7个 (与 CSV 数据匹配)
 * 基于 Merged_Data of Gas and FS.csv 实际列
 */
export const FS_SENSOR_POSITIONS: Record<string, SensorPosition> = {
  // ====== 三采区域 (3个: FS1-FS3) ======
  FS010103: { x: 1316, y: 505, zone: 5, type: "FS" }, // FS1
  FS010104: { x: 1346, y: 505, zone: 5, type: "FS" }, // FS2
  FS010105: { x: 1375, y: 505, zone: 5, type: "FS" }, // FS3

  // ====== 四采水仓区域 (2个: FS4-FS5) ======
  FS010201: { x: 1420, y: 505, zone: 5, type: "FS" }, // FS4
  FS010202: { x: 1455, y: 505, zone: 5, type: "FS" }, // FS5

  // ====== 四采轨道区域 (2个: FS6-FS7) ======
  FS010301: { x: 1490, y: 505, zone: 5, type: "FS" }, // FS6
  FS010302: { x: 1525, y: 505, zone: 5, type: "FS" }, // FS7
};

// 所有传感器位置
export const ALL_SENSOR_POSITIONS: Record<string, SensorPosition> = {
  ...T_SENSOR_POSITIONS,
  ...WD_SENSOR_POSITIONS,
  ...FS_SENSOR_POSITIONS,
};

// 获取传感器位置
export function getSensorPosition(sensorId: string): SensorPosition | null {
  return ALL_SENSOR_POSITIONS[sensorId] || null;
}

// 获取传感器总数
export function getSensorCount(): { t: number; wd: number; fs: number; total: number } {
  const t = Object.keys(T_SENSOR_POSITIONS).length;
  const wd = Object.keys(WD_SENSOR_POSITIONS).length;
  const fs = Object.keys(FS_SENSOR_POSITIONS).length;
  return { t, wd, fs, total: t + wd + fs };
}

/**
 * ============================================
 * 巷道路径数据 - 基于 drawio 精确坐标
 * ============================================
 */

// 水平线段 - 顶层 y=200
export const LINES_Y200: Array<[number, number, number, number]> = [
  [60, 200, 940, 200],   // 左段
  [950, 200, 1600, 200], // 右段
];

// 水平线段 - 顶层下边 y=210
export const LINES_Y210: Array<[number, number, number, number]> = [
  [60, 210, 80, 210],
  [90, 210, 230, 210],
  [240, 210, 600, 210],
  [610, 210, 820, 210],
  [830, 210, 950, 210],
  [960, 210, 1120, 210],
  [1130, 210, 1160, 210],
  [1170, 210, 1600, 210],
];

// 水平线段 - 中层上边 y=280
export const LINES_Y280: Array<[number, number, number, number]> = [
  [0, 280, 10, 280],    // 短段
  [20, 280, 160, 280],  // 与斜向工作面相连
  [170, 280, 600, 280],
  [610, 280, 820, 280],
  [830, 280, 1002, 280],
  [1012, 280, 1120, 280],
  [1130, 280, 1600, 280],
];

// 水平线段 - 中层下边 y=290
export const LINES_Y290: Array<[number, number, number, number]> = [
  [0, 290, 380, 290],
  [390, 290, 430, 290],
  [440, 290, 520, 290],
  [530, 290, 600, 290],
  [610, 290, 730, 290],
  [740, 290, 920, 290],
  [930, 290, 1009, 290],
  [1019, 290, 1353, 290],
  [1363, 290, 1379, 290],
  [1387, 290, 1600, 290],
];

// 水平线段 - 下层上边 y=360
export const LINES_Y360: Array<[number, number, number, number]> = [
  [100, 360, 600, 360],
  [610, 360, 730, 360],
  [741, 360, 970, 360],
  [980, 360, 1060, 360],
  [1072, 360, 1120, 360],
  [1129, 360, 1310, 360],
  [1320, 360, 1379, 360],
  [1387, 360, 1400, 360],
  [1410, 360, 1600, 360],
];

// 水平线段 - 下层下边 y=370
export const LINES_Y370: Array<[number, number, number, number]> = [
  [100, 370, 1068, 370],
  [1080, 370, 1190, 370],
  [1200, 370, 1230, 370],
  [1240, 370, 1340, 370],
  [1350, 370, 1380, 370],
  [1390, 370, 1440, 370],
  [1451, 370, 1540, 370],
  [1550, 370, 1600, 370],
];

// 水平线段 - 底层 y=480
export const LINES_Y480: Array<[number, number, number, number]> = [
  [1160, 480, 1230, 480],
  [1240, 480, 1440, 480],
  [1450, 480, 1570, 480],
  [1580, 480, 1600, 480],
];

// 水平线段 - 底层下边 y=490
export const LINES_Y490: Array<[number, number, number, number]> = [
  [1157, 490, 1600, 490],
];

// 其他水平线段
export const LINES_OTHER_HORIZONTAL: Array<[number, number, number, number]> = [
  // y=400 区域
  [1240, 400, 1340, 400], // 通过曲线连接
  [1350, 400, 1390, 400],
  [1390, 400, 1440, 400],
  [1450, 400, 1510, 400],
  // y=410 区域
  [360, 410, 480, 410],
  [350, 420, 470, 420],
  [1240, 410, 1450, 410], // 通过曲线连接
];

// 垂直线段
export const VERTICAL_LINES: Array<[number, number, number, number]> = [
  // x=600-610 区域 (垂直连接)
  [600, 210, 600, 360],
  [610, 210, 610, 360],
  // x=820-830 区域
  [820, 210, 820, 280],
  [830, 210, 830, 280],
  // x=730-741 区域
  [730, 290, 730, 360],
  [741, 290, 741, 360],
  // x=1120-1130 区域 (L形主竖直)
  [1120, 210, 1120, 360],
  [1130, 210, 1130, 280],
  [1129, 290, 1129, 360],
  // x=1160-1170 区域
  [1160, 210, 1160, 280],
  [1170, 210, 1170, 280],
  [1160, 400, 1160, 480],
  [1170, 400, 1170, 480],
  // x=1230 区域
  [1230, 370, 1230, 480],
  // x=1240 区域 (拆分为两段，中间 y=400-410 有缺口)
  [1240, 370, 1240, 400],
  [1240, 410, 1240, 480],
  // x=1310-1320 区域
  [1310, 290, 1310, 360],
  [1320, 290, 1320, 360],
  // x=1379-1387 区域
  [1379, 290, 1379, 314],
  [1379, 329, 1379, 360],
  [1387, 290, 1387, 326],
  [1387, 341, 1387, 360],
  // x=1440 区域 (拆分为两段，中间 y=400-410 有缺口)
  [1440, 370, 1440, 400],
  [1440, 410, 1440, 480],
  // x=1451 区域 (只有下段)
  [1451, 410, 1451, 480],
  // x=1450 区域
  [1450, 370, 1450, 400],
  // 工作面3竖直段
  [350, 320, 350, 420],
  [360, 320, 360, 410],
  // x=1350, 1390 短竖直
  [1350, 370, 1350, 400],
  [1390, 370, 1390, 400],
];

// 斜向线段 (工作面和连接)
export const DIAGONAL_LINES: Array<[number, number, number, number]> = [
  // === 顶部进风口斜向通道（向上到 y=100）===
  [950, 200, 870, 100],
  [940, 200, 860, 100],
  // 工作面1 (左上)
  [10, 280, 80, 210],
  [20, 280, 90, 210],
  // 工作面2
  [160, 280, 230, 210],
  [170, 280, 240, 210],
  // 工作面3
  [350, 320, 380, 290],
  [360, 320, 390, 290],
  // 工作面5 (斜向)
  [970, 360, 920, 290],
  [980, 360, 930, 290],
  // 主斜向通道 (关键！从顶层到底层)
  [1157, 490, 950, 210],
  [1160, 480, 960, 210],
  [1130, 440, 960, 210], // 补充线
  // L形分支斜向
  [1160, 400, 1190, 370],
  [1170, 400, 1200, 370],
  // 右侧斜向
  [1400, 360, 1353, 290],
  [1410, 360, 1363, 290],
  // 最右侧斜向工作面
  [1510, 400, 1540, 370],
  [1520, 400, 1550, 370],
];

// U形连接 (工作面4)
export const U_SHAPED_PATHS: string[] = [
  "M 520,290 L 520,320 L 440,320 L 440,290",
  "M 530,290 L 530,330 L 430,330 L 430,290",
];

// 折线路径 (L形直角折线，不是曲线)
export const CURVED_PATHS: string[] = [
  // L形分支折线连接 - 使用 L 命令画直角折线
  "M 1240,400 L 1340,400 L 1340,370",
  "M 1240,410 L 1350,410",
  "M 1350,410 L 1440,410",
  "M 1350,400 L 1380,400 L 1380,370",
  // 最右侧折线
  "M 1520,400 L 1580,400 L 1580,480",
  "M 1450,410 L 1570,410 L 1570,480",
];

// 气流箭头位置 - [x1, y1, x2, y2, direction: 'intake'|'return']
export const AIRFLOW_ARROWS: Array<{ from: [number, number]; to: [number, number]; type: "intake" | "return" }> = [
  // 进风方向 (绿色) - 顶层向右
  { from: [110, 165], to: [190, 165], type: "intake" },
  { from: [340, 165], to: [420, 165], type: "intake" },
  { from: [570, 165], to: [650, 165], type: "intake" },
  // 回风方向 (红色) - 中层向左
  { from: [1140, 180], to: [1060, 180], type: "return" },
  { from: [1530, 260], to: [1450, 260], type: "return" },
  { from: [1370, 260], to: [1290, 260], type: "return" },
  { from: [1100, 260], to: [1020, 260], type: "return" },
  { from: [950, 260], to: [870, 260], type: "return" },
  { from: [770, 260], to: [690, 260], type: "return" },
  { from: [480, 260], to: [400, 260], type: "return" },
  { from: [330, 260], to: [250, 260], type: "return" },
  { from: [155, 260], to: [75, 260], type: "return" },
  // 下部巷道
  { from: [170, 340], to: [250, 340], type: "intake" },
  { from: [570, 315], to: [600, 315], type: "intake" },
  { from: [580, 340], to: [550, 340], type: "return" },
  { from: [920, 340], to: [840, 340], type: "return" },
  { from: [1570, 340], to: [1490, 340], type: "return" },
  { from: [1295, 340], to: [1215, 340], type: "return" },
  // L形分支
  { from: [1480, 540], to: [1400, 540], type: "return" },
  { from: [1550, 385], to: [1630, 385], type: "intake" },
  // 斜向通道入口
  { from: [900, 185], to: [850, 125], type: "intake" },
];

/**
 * 工作面定义 - 基于 drawio 的 polygon
 * 注意：大部分工作面在 drawio 中只是两条平行斜线，没有填充
 *       它们的斜线已在 DIAGONAL_LINES 中定义
 *       只有 U 形工作面4 是封闭区域需要填充
 */
export const WORKING_FACES: Array<{ points: string; zone: number }> = [
  // 已移除工作面4的特殊背景标记
];
